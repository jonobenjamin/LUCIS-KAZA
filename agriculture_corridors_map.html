<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZA Agriculture Fields & Micro Corridors</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5; }
        .header { background-color: #2c3e50; color: white; padding: 20px; text-align: center; }
        .map-container { height: calc(100vh - 80px); position: relative; }
        #map { height: 100%; width: 100%; }
        .legend { position: absolute; bottom: 10px; left: 10px; background: white; padding: 15px; border-radius: 5px; box-shadow: 0 0 15px rgba(0,0,0,0.2); z-index: 1000; }
        .legend-item { display: flex; align-items: center; margin-bottom: 8px; }
        .legend-color { width: 20px; height: 20px; margin-right: 10px; border: 1px solid #ccc; }
        .status { position: absolute; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 15px rgba(0,0,0,0.2); z-index: 1000; }
    </style>
</head>
<body>
    <div class="header">
        <h1>KAZA Agriculture Fields & Sensitivity Corridors</h1>
        <p>Green agriculture fields with pre-buffered corridors in different shades of red</p>
    </div>

    <div class="map-container">
        <div id="map"></div>

        <div class="status" id="status">Loading agriculture data...</div>

        <div class="legend">
            <h4>Map Legend</h4>
            <div class="legend-item"><div class="legend-color" style="background-color: #28a745"></div><span>Agriculture Fields</span></div>
            <div class="legend-item"><div class="legend-color" style="background-color: #ff0000"></div><span>Sensitivity Corridors</span></div>
            <div class="legend-item"><div class="legend-color" style="background-color: #cc0000"></div><span>Buffer Zones (Various)</span></div>
            <div class="legend-item"><div class="legend-color" style="background-color: #880000"></div><span>Pre-buffered Areas</span></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/shpjs@4.0.4/dist/shp.js"></script>
    <script>
        // Initialize map
        const map = L.map('map').setView([-18.5, 23.5], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);


        // Load agriculture fields first (green) - ACTUAL DATA
        const agriUrl = 'https://jonobenjamin.github.io/LUCIS-KAZA/Data/Agri_fields_converted.geojson';
        console.log('Loading agriculture GeoJSON from:', agriUrl);

        fetch(agriUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(agriGeojson => {
                console.log('Loaded agriculture fields:', agriGeojson.features.length, 'features');

                // Add agriculture fields in green
                const agriLayer = L.geoJSON(agriGeojson, {
                    style: {
                        color: '#28a745',
                        weight: 1,
                        opacity: 1,
                        fillColor: '#28a745',
                        fillOpacity: 0.7
                    },
                            onEachFeature: function(feature, layer) {
                                layer.bindPopup(`<b>Agriculture Field</b><br>ID: ${feature.properties.id || 'N/A'}`);
                            }
                });

                agriLayer.addTo(map);
                console.log('Added agriculture fields to map');

                document.getElementById('status').textContent = 'Loading micro corridors...';

                // Load pre-buffered corridors with different shades of red - ACTUAL DATA
                const corridorsUrl = 'https://jonobenjamin.github.io/LUCIS-KAZA/Data/KAZA_corridors_sensitivity.geojson';
                console.log('Loading pre-buffered corridors from:', corridorsUrl);

                return fetch(corridorsUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(corridorsGeojson => {
                        console.log('Loaded sensitivity corridors:', corridorsGeojson.features.length, 'features');

                        // Define different shades of red for styling
                        const redShades = [
                            '#ff0000', // Bright red
                            '#cc0000', // Dark red
                            '#aa0000', // Deeper red
                            '#880000', // Very dark red
                            '#660000', // Deep maroon
                            '#440000'  // Almost black red
                        ];

                        // Add pre-buffered corridors with different shades of red
                        const corridorsLayer = L.geoJSON(corridorsGeojson, {
                            style: function(feature, layer) {
                                // Use different shades based on feature index or properties
                                const index = feature.properties.id ? parseInt(feature.properties.id) : layer._leaflet_id % redShades.length;
                                const shadeIndex = index % redShades.length;

                                return {
                                    color: redShades[shadeIndex],
                                    weight: 2,
                                    opacity: 1,
                                    fillColor: redShades[shadeIndex],
                                    fillOpacity: 0.8
                                };
                            },
                            onEachFeature: function(feature, layer) {
                                const props = feature.properties;
                                layer.bindPopup(`
                                    <b>Sensitivity Corridor</b><br>
                                    <strong>ID:</strong> ${props.id || 'N/A'}<br>
                                    <strong>Buffer Level:</strong> Pre-buffered
                                `);
                            }
                        });

                        corridorsLayer.addTo(map);
                        console.log('Added sensitivity corridors with red shades');

                        // Fit map to show both layers
                        const allLayers = [agriLayer, corridorsLayer];
                        const group = new L.featureGroup(allLayers);
                        map.fitBounds(group.getBounds(), { padding: [20, 20] });

                        document.getElementById('status').textContent = 'Map loaded successfully';
                    });
            })
            .catch(error => {
                console.error('Error loading agriculture or corridor data:', error);
                document.getElementById('status').textContent = `Error: ${error.message}`;
            });


        console.log('Agriculture and corridors map initialized');
    </script>
</body>
</html>
